'use strict';/**
 *@NApiVersion 2.x
 *@NScriptType Suitelet
 *@NModuleScope SameAccount
 *Update vend item count (NS->Vend)
 */define(['N/record','N/search','N/https','N/format'],function(a,b,c){var d=function(a){return{quantity:a.quantity,productId:a.vend_id,outletId:a.location_vend_id}},e=function(a){return{id:a.getValue({name:'internalid'}),name:a.getValue({name:'name'}),vend_id:a.getValue({name:'custrecord_vend_id_location'})}},f=function(a){return{sku:a.getValue({name:'itemid'}),name:a.getValue({name:'displayname'}),modified:a.getValue({name:'modified'}),location:a.getValue({name:'inventorylocation'}),quantity:a.getValue({name:'locationquantityavailable'}),vend_id:a.getValue({name:'custitem_vend_id_item'})}},g=function(a){return a.id},h=function(a){var b=a.params,c=a.items,d=a.locationsInfo,e='<h2>Items</h2>';e+='<br />',e+=c.map(function(a){return JSON.stringify(a)}).join('<br />'),e+='<br />',e+='<h2>Locations</h2>',e+=JSON.stringify(d,null,4),b.response.write({output:e})},i=function(){var a=m({type:b.Type.LOCATION,filters:[],columns:['internalid','name','custrecord_vend_id_location'],extractor:e}),c={};return a.filter(function(a){return a.vend_id}).forEach(function(a){c[a.id]=a}),c},j=function(){// http://www.netsuite.com/help/helpcenter/en_US/srbrowser/Browser2017_2/script/record/item.html
var a=k();return o('ids',a),m({type:b.Type.INVENTORY_ITEM,filters:[['internalid','anyof',a]],columns:['itemid','location','modified','displayname','inventorylocation','locationquantityavailable','custitem_vend_id_item'],extractor:f})},k=function(){// Consulta última actualización artículos de inventario v0.1
var a=b.load({id:'customsearch203'}),c=[];return a.run().each(function(a){return c.push(g(a)),!0}),c.filter(l)},l=function(a,b,c){return c.indexOf(a)===b},m=function(a){var c=a.type,d=a.filters,e=a.columns,f=a.extractor,g=void 0===f?function(a){return a}:f,h=b.create({type:c,filters:d,columns:e}),i=[];return h.run().each(function(a){return i.push(g(a)),!0}),i},n=function(a){o('Send body to api',a);var b=c.post({body:JSON.stringify(a),url:'https://rizer-redcpp.now.sh/nyscollection/inventory-adjustment',headers:{Accept:'application/json',"Content-Type":'application/json'}});return o('Api response',JSON.parse(b.body)),b},o=function(a,b){log.audit({title:a,details:b})};return{onRequest:function g(a){try{var b=i(),c=j().filter(function(a){return a.sku}),e=c.map(function(a){var c=b[a.location];return a.location_vend_id=c&&c.vend_id,a}).filter(function(a){return a.vend_id&&a.location_vend_id}),f=e.map(d);n(f),h({params:a,items:e,locationsInfo:b})}catch(a){o('Error',a)}}}});